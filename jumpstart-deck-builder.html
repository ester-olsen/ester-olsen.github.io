<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ester's Jumpstart deck builder</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>
<body>
    <div class="container">
        <h1>Ester's Jumpstart deck builder</h1>
        <p class="text-muted">Ester Olsen, 2022-02-22.</p>
        <ol>
            <li><a href="#importPacks">Import packs</a></li>
            <li><a href="#twoPackJumpstart">Two-pack Jumpstart</a></li>
            <li><a href="#fourPackJumpstart">Four-pack Jumpstart</a></li>
        </ol>
        <h2 id="importPacks">Import packs</h2>
        <p>Import a CSV file containing Jumpstart packs to randomly pick from.</p>
        <p class="font-monospace">Pack name,Pack image URL,Card set ID,Card name</p>
        <p>The first row is skipped over. Strings are encapsulated by quotation marks.</p>
        <label class="form-label w-100">
            CSV file
            <input type="file" id="fileInput" class="form-control" />
        </label>
        <h2 id="twoPackJumpstart">Two-pack Jumpstart</h2>
        <figure>
            <blockquote cite="https://magic.wizards.com/en/articles/archive/card-preview/behind-scenes-designing-jumpstart-2020-06-17" class="blockquote">
                <p>In Two-Pack, you just open two packs and shuffle them together, and you're ready to play. That's the absolute simplest way to play Jumpstart. No agonizing over your twenty-third card or whether to run that off-color cycling landâ€”just fire it up.</p>
            </blockquote>
            <figcaption class="blockquote-footer">https://magic.wizards.com/en/articles/archive/card-preview/behind-scenes-designing-jumpstart-2020-06-17</figcaption>
        </figure>
        <p id="packs">
            <img src="" id="imageOne" style="width: 10em;" />
            <img src="" id="imageTwo" style="width: 10em;" />
        </p>
        <textarea readonly rows="10" id="textarea" class="form-control mb-4"></textarea>
        <h2 id="fourPackJumpstart">Four-pack Jumpstart</h2>
        <figure>
            <blockquote cite="https://magic.wizards.com/en/articles/archive/card-preview/behind-scenes-designing-jumpstart-2020-06-17" class="blockquote">
                <p>To play Four-Pack Jumpstart, open four Jumpstart packs and lay out your four themes in front of you. Create two 40-card decks by combining pairs of themes together however you like.</p>
                <p>For example, if the themes I opened were Teferi, Predatory, Walls, and Spellcasting, I might build "Predatory Walls" and "Spellcasting Teferi" as my two decks. Remove the theme label cards, shuffle your two decks separately, and you're ready to play.</p>
                <p>Find an opponent and play a Best-of-Three match. Each player chooses whichever of their two decks they want for the first game, then each player switches to their other deck for game two. Then, after game two, if no player has two wins yet, each player may pick either of their decks for the deciding game three.</p>
                <p>For example, I might choose to play Spellcasting Teferi in game one. In game two, I must switch to my other deck, Predatory Walls. Then if there's a game three, I could choose to play either Spellcasting Teferi or Predatory Walls.</p>
            </blockquote>
            <figcaption class="blockquote-footer">https://magic.wizards.com/en/articles/archive/card-preview/behind-scenes-designing-jumpstart-2020-06-17</figcaption>
        </figure>
        <h3>Your packs</h3>
        <div class="row">
            <div class="col"><img src="" id="packOneImage" style="width: 10em;" /></div>
            <div class="col"><textarea rows="10" readonly id="packOneTextarea" class="form-control"></textarea></div>
        </div>
        <hr />
        <div class="row">
            <div class="col"><img src="" id="packTwoImage" style="width: 10em;" /></div>
            <div class="col"><textarea rows="10" readonly id="packTwoTextarea" class="form-control"></textarea></div>
        </div>
        <hr />
        <div class="row">
            <div class="col"><img src="" id="packThreeImage" style="width: 10em;" /></div>
            <div class="col"><textarea rows="10" readonly id="packThreeTextarea" class="form-control"></textarea></div>
        </div>
        <hr />
        <div class="row mb-4">
            <div class="col"><img src="" id="packFourImage" style="width: 10em;" /></div>
            <div class="col"><textarea rows="10" readonly id="packFourTextarea" class="form-control"></textarea></div>
        </div>
        <h3>Your decks</h3>
        <div class="row mb-4">
            <div class="col border-end">
                <h4 class="text-secondary">Deck 1</h3>
                <div class="form-check w-100">
                    <label for="deckOneCheckboxOne" class="form-check-label"></label>
                    <input type="checkbox" id="deckOneCheckboxOne" class="form-check-input" />
                </div>
                <div class="form-check w-100">
                    <label for="deckOneCheckboxTwo" class="form-check-label"></label>
                    <input type="checkbox" id="deckOneCheckboxTwo" class="form-check-input" />
                </div>
                <div class="form-check w-100">
                    <label for="deckOneCheckboxThree" class="form-check-label"></label>
                    <input type="checkbox" id="deckOneCheckboxThree" class="form-check-input" />
                </div>
                <div class="form-check w-100 mb-2">
                    <label for="deckOneCheckboxFour" class="form-check-label"></label>
                    <input type="checkbox" id="deckOneCheckboxFour" class="form-check-input" />
                </div>
                <textarea rows="10" readonly id="deckOneTextarea" class="form-control"></textarea>
            </div>
            <div class="col">
                <h4 class="text-secondary">Deck 2</h3>
                <div class="form-check w-100">
                    <label for="deckTwoCheckboxOne" class="form-check-label"></label>
                    <input type="checkbox" id="deckTwoCheckboxOne" class="form-check-input" />
                </div>
                <div class="form-check w-100">
                    <label for="deckTwoCheckboxTwo" class="form-check-label"></label>
                    <input type="checkbox" id="deckTwoCheckboxTwo" class="form-check-input" />
                </div>
                <div class="form-check w-100">
                    <label for="deckTwoCheckboxThree" class="form-check-label"></label>
                    <input type="checkbox" id="deckTwoCheckboxThree" class="form-check-input" />
                </div>
                <div class="form-check w-100 mb-2">
                    <label for="deckTwoCheckboxFour" class="form-check-label"></label>
                    <input type="checkbox" id="deckTwoCheckboxFour" class="form-check-input" />
                </div>
                <textarea rows="10" readonly id="deckTwoTextarea" class="form-control"></textarea>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script>
        document.getElementById('fileInput').addEventListener('change', function() {
            let twoPackElements = {
                images: [document.getElementById('imageOne'), document.getElementById('imageTwo')],
                textarea: document.getElementById('textarea')
            };
            let fourPackElements = {
                packImages: [
                    document.getElementById('packOneImage'),
                    document.getElementById('packTwoImage'),
                    document.getElementById('packThreeImage'),
                    document.getElementById('packFourImage')
                ],
                packTextareas: [
                    document.getElementById('packOneTextarea'),
                    document.getElementById('packTwoTextarea'),
                    document.getElementById('packThreeTextarea'),
                    document.getElementById('packFourTextarea')
                ],
                deckCheckboxes: [[
                    document.getElementById('deckOneCheckboxOne'),
                    document.getElementById('deckOneCheckboxTwo'),
                    document.getElementById('deckOneCheckboxThree'),
                    document.getElementById('deckOneCheckboxFour')
                ], [
                    document.getElementById('deckTwoCheckboxOne'),
                    document.getElementById('deckTwoCheckboxTwo'),
                    document.getElementById('deckTwoCheckboxThree'),
                    document.getElementById('deckTwoCheckboxFour')
                ]],
                deckTextareas: [
                    document.getElementById('deckOneTextarea'),
                    document.getElementById('deckTwoTextarea')
                ]
            };
            onFileInputChange(document.getElementById('fileInput'), twoPackElements, fourPackElements);
        });

        function onFileInputChange(input, twoPackElements, fourPackElements) {
            const fileReader = new FileReader;

            fileReader.onload = function() {
                let records = fileReader.result.split('\n').slice(1).map(row => {
                    let columns = row.split(',').map(column => column.trim());
                    if (columns > 4) {
                        return columns.slice(0, 3).concat(columns.slice(3).join(','));
                    }
                    if (columns.length == 4) {
                        return columns.map(column => column.substring(1, column.length - 1));
                    }
                    else {
                        return null;
                    }
                }).filter(x => x != null);
                let packs = [];
                records.forEach(record => {
                    let pack = packs.find(x => x.name == record[0]);
                    if (!pack) {
                        pack = new Pack(record[0], record[1], []);
                        packs.push(pack);
                    }
                    if (!pack.cards.find(x => x.name == record[3])) {
                        let quantity = records.filter(x => x[0] == record[0] && x[3] == record[3]).length;
                        pack.cards.push(new Card(record[3], record[2], quantity));
                    }
                });
                console.log(packs);
                openTwoPacks(packs, twoPackElements);
                openFourPacks(packs, fourPackElements);
            }

            fileReader.readAsText(input.files[0]);
        }

        function openTwoPacks(packs, elements) {
            shuffle(packs);
            for (let i = 0; i < 2; i++) {
                elements.images[i].setAttribute('src', packs[i].imageURL);
            }
            write(packs.slice(0, 2), elements.textarea);
        }

        function openFourPacks(packs, elements) {
            shuffle(packs);

            // Update pack images
            for (let i = 0; i < 4; i++) {
                elements.packImages[i].setAttribute('src', packs[i].imageURL);
            }

            // Update pack lists
            for (let i = 0; i < 4; i++) {
                write([packs[i]], elements.packTextareas[i]);
            }

            for (let deckIndex = 0; deckIndex < 2; deckIndex++) {
                for (let checkIndex = 0; checkIndex < 4; checkIndex++) {
                    let checkbox = elements.deckCheckboxes[deckIndex][checkIndex];

                    // Update checkbox labels
                    checkbox.previousElementSibling.innerHTML = packs[checkIndex].name;
                    checkbox.checked = false;

                    // Update checkbox events
                    checkbox.addEventListener('change', () => {
                        writeDeck(packs.slice(0, 4), elements.deckCheckboxes[deckIndex], elements.deckTextareas[deckIndex]);
                        updateCheckboxes(elements.deckCheckboxes);
                    });
                }
            }

            function writeDeck(packs, checkboxes, textarea) {
                let checkedPacks = [];
                for (let i = 0; i < 4; i++) {
                    if (checkboxes[i].checked) {
                        checkedPacks.push(packs[i]);
                    }
                }
                write(checkedPacks, textarea);
            }

            function updateCheckboxes(deckCheckboxes) {
                let indexes = [];
                for (let deckIndex = 0; deckIndex < 2; deckIndex++) {
                    for (let checkIndex = 0; checkIndex < 4; checkIndex++) {
                        if (deckCheckboxes[deckIndex][checkIndex].checked && !indexes.includes(checkIndex)) {
                            indexes.push(checkIndex);
                        }
                    }
                }
                for (let deckIndex = 0; deckIndex < 2; deckIndex++) {
                    let checked = deckCheckboxes[deckIndex].filter(x => x.checked).length;
                    for (let checkIndex = 0; checkIndex < 4; checkIndex++) {
                        let checkbox = deckCheckboxes[deckIndex][checkIndex];
                        if (checkbox.checked || (checked < 2 && !indexes.includes(checkIndex))) {
                            checkbox.removeAttribute('disabled');
                            checkbox.previousElementSibling.classList.remove('text-muted');
                        }
                        else {
                            checkbox.setAttribute('disabled', 'true');
                            checkbox.previousElementSibling.classList.add('text-muted');
                        }
                    }
                }
            }
        }

        function write(packs, textarea) {
            textarea.innerHTML = '';
            packs.forEach(pack => {
                pack.cards.forEach(card => {
                    textarea.innerHTML += `${card.quantity} ${card.name} (${card.setID})\n`;
                });
            });
        }

        function shuffle(packs) {
            for (let i = packs.length -1; i > 0; i--) {
                let j = Math.floor(Math.random() * i);
                let k = packs[i];
                packs[i] = packs[j];
                packs[j] = k;
            }
        }

        function Pack(name, imageURL, cards) {
            this.name = name;
            this.imageURL = imageURL;
            this.cards = cards;
        }

        function Card(name, setID, quantity) {
            this.name = name;
            this.setID = setID;
            this.quantity = quantity;
        }
    </script>
</body>
</html>
